Description: Enable tox use of site-packages for libvirt
 Enable the use of site-packages in tox which will allow the use of the
 system install of libvirt while testing.
 .
 Hardcode the libvirt host UUID for tests that check this UUID when
 system libvirt is being used. Without this hardcoding eight tests
 would fail when using the system libvirt install.
Author: Clark Boylan <clark.boylan@gmail.com>
Origin: upstream, https://review.openstack.org/#/c/21491
Bug-Ubuntu: https://launchpad.net/bugs/1113181

Index: nova/tox.ini
===================================================================
--- nova.orig/tox.ini	2013-08-30 17:16:22.000000000 +0800
+++ nova/tox.ini	2013-08-30 17:22:09.000000000 +0800
@@ -2,6 +2,7 @@
 envlist = py26,py27,pep8
 
 [testenv]
+sitepackages = True
 setenv = VIRTUAL_ENV={envdir}
          LANG=en_US.UTF-8
          LANGUAGE=en_US:en
Index: nova/nova/tests/test_libvirt.py
===================================================================
--- nova.orig/nova/tests/test_libvirt.py	2013-08-30 17:16:22.000000000 +0800
+++ nova/nova/tests/test_libvirt.py	2013-08-30 17:22:09.000000000 +0800
@@ -291,6 +291,13 @@
         self.useFixture(fixtures.MonkeyPatch(
             'nova.virt.libvirt.driver.libvirt_utils',
             fake_libvirt_utils))
+        # Force libvirt to return a host UUID that matches the serial in
+        # nova.tests.fakelibvirt. This is necessary because the host UUID
+        # returned by libvirt becomes the serial whose value is checked for in
+        # test_xml_and_uri_* below.
+        self.useFixture(fixtures.MonkeyPatch(
+            'nova.virt.libvirt.driver.LibvirtDriver.get_host_uuid',
+            lambda _: 'cef19ce0-0ca2-11df-855d-b19fbce37686'))
         self.useFixture(fixtures.MonkeyPatch(
             'nova.virt.libvirt.imagebackend.libvirt_utils',
             fake_libvirt_utils))
